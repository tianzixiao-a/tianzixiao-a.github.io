function percent(){let a=document.documentElement.scrollTop||window.pageYOffset,b=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-document.documentElement.clientHeight,result=Math.round(a/b*100),btn;result<=99||(result=99),document.querySelector("#percent").innerHTML=result}window.onscroll=percent,document.getElementById("page-name").innerText=document.title.split(" | 天子笑")[0];var tzx_musicPlaying=!1,tzx_musicStretch=!1,tzx_musicFirst=!1,tzx={musicToggle:function(){tzx_musicFirst||(musicBindEvent(),tzx_musicFirst=!0);let msgPlay='<i class="fa-solid fa-play"></i><span>播放音乐</span>',msgPause='<i class="fa-solid fa-pause"></i><span>暂停音乐</span>';tzx_musicPlaying?(document.querySelector("#nav-music").classList.remove("playing"),document.getElementById("menu-music-toggle").innerHTML=msgPlay,document.getElementById("nav-music-hoverTips").innerHTML="音乐已暂停",tzx_musicPlaying=!1,document.querySelector("#nav-music").classList.remove("stretch"),tzx_musicStretch=!1):(document.querySelector("#nav-music").classList.add("playing"),document.getElementById("menu-music-toggle").innerHTML=msgPause,tzx_musicPlaying=!0,document.querySelector("#nav-music").classList.add("stretch"),tzx_musicStretch=!0),document.querySelector("meting-js").aplayer.toggle()},musicTelescopic:function(){tzx_musicStretch?(document.querySelector("#nav-music").classList.remove("stretch"),tzx_musicStretch=!1):(document.querySelector("#nav-music").classList.add("stretch"),tzx_musicStretch=!0)},musicSkipBack:function(){document.querySelector("meting-js").aplayer.skipBack()},musicSkipForward:function(){document.querySelector("meting-js").aplayer.skipForward()},musicGetName:function(){for(var x=$(".aplayer-title"),arr=[],i=x.length-1;i>=0;i--)arr[i]=x[i].innerText;return arr[0]}};addRightMenuClickEvent();const commentBarrageConfig={lightColors:[["var(--tzx-white-acrylic2)","var(--tzx-black)"]],darkColors:[["var(--tzx-black-acrylic2)","var(--tzx-white)"]],maxBarrage:1,barrageTime:3e3,twikooUrl:"https://twikoo.tzxblog.eu.org",accessToken:"3292ebc70781a7cfac64cc91a176d332",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"retro",dom:document.querySelector(".comment-barrage"),displayBarrage:!0,avatarCDN:"cravatar.cn"};function isInViewPortOfOne(el){const viewPortHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,offsetTop=el.offsetTop,scrollTop=document.documentElement.scrollTop,top=offsetTop-scrollTop;return top<=viewPortHeight}function initCommentBarrage(){var data=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":commentBarrageConfig.accessToken,url:commentBarrageConfig.pageUrl}),xhr=new XMLHttpRequest;xhr.withCredentials=!0,xhr.addEventListener("readystatechange",(function(){4===this.readyState&&(commentBarrageConfig.barrageList=commentLinkFilter(JSON.parse(this.responseText).data),commentBarrageConfig.dom.innerHTML="")})),xhr.open("POST",commentBarrageConfig.twikooUrl),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(data),setInterval(()=>{commentBarrageConfig.barrageList.length&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length),commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift())},commentBarrageConfig.barrageTime)}function commentLinkFilter(data){data.sort((a,b)=>a.created-b.created);let newData=[];return data.forEach(item=>{newData.push(...getCommentReplies(item))}),newData}function getCommentReplies(item){if(item.replies){let replies=[item];return item.replies.forEach(item=>{replies.push(...getCommentReplies(item))}),replies}return[]}function popCommentBarrage(data){let barrage=document.createElement("div"),width=commentBarrageConfig.dom.clientWidth,height=commentBarrageConfig.dom.clientHeight;barrage.className="comment-barrage-item";let ran=Math.floor(Math.random()*commentBarrageConfig.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${commentBarrageConfig.lightColors[ran][0]};color:${commentBarrageConfig.lightColors[ran][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${commentBarrageConfig.darkColors[ran][0]};color:${commentBarrageConfig.darkColors[ran][1]}}`,barrage.innerHTML=`\n\t\t<div class="barrageHead">\n\t\t\t<img class="barrageAvatar" src="https://${commentBarrageConfig.avatarCDN}/avatar/${data.mailMd5}?d=${commentBarrageConfig.noAvatarType}"/>\n\t\t\t<div class="barrageNick">${data.nick}</div>\n\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n\t\t</div>\n\t\t<div class="barrageContent">${data.comment}</div>\n\t`,commentBarrageConfig.barrageTimer.push(barrage),commentBarrageConfig.dom.append(barrage)}function removeCommentBarrage(barrage){barrage.className="comment-barrage-item out",1!=commentBarrageConfig.maxBarrage?setTimeout(()=>{commentBarrageConfig.dom.removeChild(barrage)},1e3):commentBarrageConfig.dom.removeChild(barrage)}document.onscroll=function(){commentBarrageConfig.displayBarrage&&(isInViewPortOfOne(document.getElementById("post-comment"))?document.getElementsByClassName("comment-barrage")[0].setAttribute("style","display:none;"):document.getElementsByClassName("comment-barrage")[0].setAttribute("style",""))},switchCommentBarrage=function(){if(localStorage.setItem("isBarrageToggle",Number(!Number(localStorage.getItem("isBarrageToggle")))),!isInViewPortOfOne(document.getElementById("post-comment"))){commentBarrageConfig.displayBarrage=!commentBarrageConfig.displayBarrage;let commentBarrage=document.querySelector(".comment-barrage");commentBarrage&&$(commentBarrage).fadeToggle()}},$(".comment-barrage").hover((function(){clearInterval(timer)}),(function(){timer=setInterval(()=>{commentBarrageConfig.barrageList.length&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length),commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift())},commentBarrageConfig.barrageTime)})),null==localStorage.getItem("isBarrageToggle")?localStorage.setItem("isBarrageToggle","0"):"1"==localStorage.getItem("isBarrageToggle")&&(localStorage.setItem("isBarrageToggle","0"),switchCommentBarrage()),initCommentBarrage();var arr=["#39c5bb","#f14747","#f1a247","#f1ee47","#b347f1","#1edbff","#ed709b","#5636ed"],idx=0;function changeColor(){if("dark"==document.getElementsByTagName("html")[0].getAttribute("data-theme")){document.getElementById("site-name")&&(document.getElementById("site-name").style.textShadow=arr[idx]+" 0 0 15px"),document.getElementById("site-title")&&(document.getElementById("site-title").style.textShadow=arr[idx]+" 0 0 15px"),document.getElementById("site-subtitle")&&(document.getElementById("site-subtitle").style.textShadow=arr[idx]+" 0 0 10px"),document.getElementById("post-info")&&(document.getElementById("post-info").style.textShadow=arr[idx]+" 0 0 5px");try{document.getElementsByClassName("author-info__name")[0].style.textShadow=arr[idx]+" 0 0 12px",document.getElementsByClassName("author-info__description")[0].style.textShadow=arr[idx]+" 0 0 12px"}catch{}8==++idx&&(idx=0)}else{document.getElementById("site-name")&&(document.getElementById("site-name").style.textShadow="#1e1e1ee0 1px 1px 1px"),document.getElementById("site-title")&&(document.getElementById("site-title").style.textShadow="#1e1e1ee0 1px 1px 1px"),document.getElementById("site-subtitle")&&(document.getElementById("site-subtitle").style.textShadow="#1e1e1ee0 1px 1px 1px"),document.getElementById("post-info")&&(document.getElementById("post-info").style.textShadow="#1e1e1ee0 1px 1px 1px");try{document.getElementsByClassName("author-info__name")[0].style.textShadow="",document.getElementsByClassName("author-info__description")[0].style.textShadow=""}catch{}}}window.onload=setInterval(changeColor,1200);